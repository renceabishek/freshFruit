<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>BRN Form</title>

    <!-- Bootstrap Core CSS 
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="fonts/Kelson Sans Regular.otf" rel="stylesheet">-->

    <!-- MetisMenu CSS 
    <link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">-->

    <!-- Custom CSS 
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">
    <link href="../css/ibsstyle.css" rel="stylesheet" type="text/css">-->

    <!-- Custom Fonts 
    <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">-->

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="../vendor/jquery/jquery.js"></script>
    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/vessel.js"></script>
    <script src="../js/port.js"></script>
    <script src="../js/fuel.js"></script>
    <script src="../js/fuelgrade.js"></script>
    <script src="../js/mailconfig.js"></script>
    <script src="../js/schedules.js"></script>
    <script src="../js/bunkerrqst.js"></script>
    <script src="../js/fuelcombi.js"></script>
    <script src="../js/rendered.js"></script>
    <script src="../js/masterreport.js"></script>
    <script src="../js/mailaction.js"></script>


</head>
<div id="page-content-wrapper">
    <form id="brn">

        <div class="container-fluid">

            <div class="row">

                <div style="background:white;border: 1px solid #ffffff;box-shadow: 5px 5px 27px #8f8e8e;border-radius: 10px;margin:0 auto;Z-INDEX: 2000; margin-top: -15px;">
                    <div class="col-sm-12" style="font-size:16px;color:#00b6e3;margin-top: 5px;font-weight:bold;background-color: darkblue;margin-top: 0px; color:white;padding:5px;border-radius:10px 10px 0 0">

                        <div class="col-sm-3 text-left" style="padding-top:7px;">
                            Bunker Requisition Form
                        </div>
                        <div class="col-sm-6 text-center" >
                            <span  maxlength="200" style="font-size:25px;" id="span_vesselname" readonly> 
                        </div>

					</div>
                    <div class="col-sm-12" style="margin-top:15px">
						<div class="col-sm-2 text-right">Bunker Port Code
                            <span class="required">&nbsp;*</span>
                        </div>
                        <div class="col-sm-2" style="padding-right:0px;">
                            <input class="form-control" list="portList" onchange="setBunkerPort(this)" id="brn_bunkerport" 
                             style="text-transform: uppercase;" > <!--*onblur=";selectrequest()"*-->
                            <datalist id="portList" />
                        </div>
                        <div class="col-sm-2 text-right">Bunker Port Name</div>
                        <div class="col-sm-2" style="padding-right:0px;">
                            <input class="form-control" id="brn_bunkerportname">
                        </div>
						<div class="col-sm-2 text-right">Date of Supply
                            <span class="required">&nbsp;*</span>
                        </div>
                        <div class="col-sm-2" style="padding-right:0px;">
                            <input class="form-control" id="brn_bunkerdate" type="date">
                        </div>
						
                        
                    </div>
                    <div class="col-sm-12">
                        <div class="col-sm-2 text-right">Voyage Number
                        </div>
                        <div class="col-sm-2" style="padding-right:0px;">
                            <input maxlength="10" class="form-control" id="brn_voyage">
                        </div>
                        <div class="col-sm-2 text-right">Service
                            <span class="required" style="color:red">&nbsp;*</span>
                        </div>
                        <div class="col-sm-2" style="padding-right:0px;">
                            <input class="form-control" id="brn_service" readonly>
                            
                        </div>
                        <div class="col-sm-2 text-right">Vessel Code
                            <span class="required" style="color:red">&nbsp;*</span>
                        </div>
                        <div class="col-sm-2" style="padding-right:0px;">
                            <input class="form-control" maxlength="10" id="brn_vesselcode" readonly>
                        </div>
                    </div>
					<div class="col-sm-12">
						<div class="col-sm-2 text-right">Vessel Name </div>
                        <div class="col-sm-3 " style="padding-right:0px;">
                            <input id="brn_vessel" class="form-control" readonly>
                        </div>
					</div>
                    <div class="form-group">
                        <div class="row">
                            <div class="col-xs-12" style="margin-top:10px">
                                <div class="section_header_top" style="height: 3px !important; width: 97%; margin-right: 0px;">
                                </div>
                                <div class="section_header">
                                    Fuel Requirement Details
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12" style="padding:18px; width:99%; margin-left:7px;">
                            <div class="panel panel-info highlighter">
                                <div class="panel-body" style="padding:6px">
                                    <table id="dataTablebrq" class="table table-bordered" style="margin-left:8px;">
                                        <thead>
                                            <tr>
                                                <th style="color:#1794b2; font-weight:bold; font-size:15px">Fuel Requirement (Fuel Type - Grade - Sulphur %)
                                                    <span class="required">&nbsp;*</span>
                                                </th>
                                                <th>Bunker Stem (MT)
                                                    <span class="required" style="color:red">&nbsp;*</span>
                                                </th>
                                                <th>Max Intake (MT)</th>
                                            </tr>
                                        </thead>
                                        <tbody >
                                     
                                        </tbody>
                                    </table>
                                </div>
                             </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12" style="padding:20px 30px; padding-bottom: 0;">
                            <div class="form-group">
                                <div class="row">
                                    <div class="section_header_top" style="height: 3px !important; width: 97%; margin-right: 0px;">
                                    </div>
                                    <div class="section_header">
                                        Remarks
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover">
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <textarea class="form-control1" rows="3" id="brn_remarks" style="height:95px;"> </textarea>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>


                    <br/>
                    <!-----------/buttons-------------->
                    <!-- /.row -->
                    <div class="form-group">
						<div class="col-lg-9" >
							<div class="col-lg-3" style="text-align: right;padding-top: 8px;padding-left: 0;padding-right: 5px;">
								<p id="lblPort" style="color:red; font-weight:bold;">Recent Bunker Requests : </p>
							</div>
							<div class="col-lg-6" style="padding: 0;">
								<p id="fooBar"></p>
							</div>
						</div>
                        <div class="col-lg-3" style="text-align: right;">
                            <!--<button type="button" class="btn btn-primary" onclick="return sendAction('brn')">Send</button>
                            <button type="button" class="btn btn-primary" id="savefile" onclick="lowdbvalidation()">Save</button>-->
                            <button type="button" class="btn btn-success" id="sendmail" onclick="SaveSend()"> <i class="fa fa-paper-plane-o"> </i> Save and Mail</button>
                            <button type="button" class="btn btn-danger" onclick="callresetb('brn')"> <i class="fa fa-undo"> </i>  Reset</button>
                        </div>
                    </div>
                    <br/>
                    <br/>
    </form>

    <div class="modal fade" id="modalCompose">
        <div class="modal-dialog" style="width: 636px">
            <div class="modal-content">
                <div class="modal-header modal-header-info">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">
                        <span class="glyphicon glyphicon-envelope"></span> Compose Mail</h4>
                </div>
                <div class="modal-body">
                    <form role="form" class="form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2" for="inputFrom">
                                <span class="glyphicon glyphicon-user"></span>From</label>
                            <div class="col-sm-10">
                                <input type="email" class="form-control" id="inputFrom">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2" for="inputTo">
                                <span class="glyphicon glyphicon-user"></span>To</label>
                            <div class="col-sm-10">
                                <input type="email" class="form-control" id="inputTo">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2" for="ccTo">
                                <span class="glyphicon glyphicon-user"></span>CC</label>
                            <div class="col-sm-10">
                                <input type="email" class="form-control" id="ccTo">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2" for="inputSubject">
                                <span class="glyphicon glyphicon-list-alt"></span>Subject</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="inputSubject" placeholder="subject">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="no-space-break col-sm-2" for="inputAttach">
                                <span class="fa fa-paperclip"></span>Attachment</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="inputAttach" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2" for="inputBody">
                                <span class="glyphicon glyphicon-list"></span>text</label>
                            <div class="col-sm-10">
                                <div class="table-responsive" >
                                    <table class="table table-striped table-bordered table-hover">
                                        <tbody>
                                                <tr>
                                                    <td>
                                                        <textarea class="form-control1" style="background-color: #eeeeee !important" maxlength="500" rows="3" id="inputBody"></textarea>
                                                     </td>
                                                </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="MailAction('brn')">Send
                        <i class="fa fa-arrow-circle-right fa-lg"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="hide-Progress-overlay show-Progress-overlay">
            <div class="glassPane">
                <div class="progress-bar">
                    <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>
                    <span class="sr-only">Loading...</span>
                    <!--md-progress-circle mode="indeterminate" color="primary"></md-progress-circle-->
                </div>
            </div>
        </div>
    </div>



    <script type="text/javascript">

        function SaveSend() {
            if($('#brn_bunkerport').val().trim()==""){
                alert("Kindly Enter the Bunker port code"); 
            }
            else if ($('#brn_bunkerdate').val().trim() == "") {
                alert("Kindly Enter the Date of supply");
            }
           else if ($('#brn_service').val().trim() == "") {
                alert("Kindly Enter the service");
            }
            else if ($('#brn_vesselcode').val().trim() == "") {
                alert("Kindly Enter the vesselcode");
            } else {
                lowdbAction("savesend");
            }
        }

        function lowdbvalidation() {
            if ($('#brn_service').val() == "") {
                alert("Kindly Enter the service");
            }
            else if ($('#brn_vesselcode').val() == "") {
                alert("Kindly Enter the vesselcode");
            }
            else if ($('#brn_bound').val() == "") {
                alert("Kindly Enter the bound");
            }
            else if ($('#brn_bunkerdate').val() == "") {
                alert("Kindly Enter the Date of supply");
            } else {
                lowdbAction("save");
            }
        }

        function lowdbAction(type) {
            var fuelarray = [];
            var table = document.getElementById("dataTablebrq");
            for (var i = 1, row; row = table.rows[i]; i++) {

                for (var j = 0, col; col = row.cells[j]; j++) {
                    if (j == 0) {
                        var fuel = ($(col).find("input").val());
                    }
                    if (j == 1) {
                        var bunstem = ($(col).find("input").val());
                    }
                    if (j == 2) {
                        var maxintake = ($(col).find("input").val());
                    }
                }
                fuelarray.push({ "fuel": fuel, "bunstem": bunstem, "maxintake": maxintake });

            }
			var brqstatus="Open";
			if (type == "savesend") {
				brqstatus = "Closed";
			}
			
			var vesselinfo = db.get('vesselinfo').value();
            var sysconfig =db.get('sysconfig').value();
					
            console.log('fuel details--'+fuelarray);
            var bunkerrequestdetails = { "service": $('#brn_service').val(), "vesselname": $('#brn_vessel').val(), "vesselcode": $('#brn_vesselcode').val(), "voyagenumber": $('#brn_voyage').val(), "Dateofsupply": $('#brn_bunkerdate').val(), 
                "bunkerportcode": $('#brn_bunkerport').val(), "bunkerportname": $('#brn_bunkerportname').val(), 
                "vslemail": sysconfig[0].vesselemail, "status":brqstatus, "fueldetails": fuelarray, "remarks": $('#brn_remarks').val() }
			var delobj={"bunkerportcode":$('#brn_bunkerport').val() }
			console.log('delport---'+delobj);
			db.get('bunkerrequest').remove(delobj).write();
			
            db.get('bunkerrequest').push(bunkerrequestdetails).write();
            var size = (db.get("bunkerrequest").size().value());
            var value = (db.get('bunkerrequest').nth(size - 1).value());
            console.log('value---'+value);
			
			
		
			showSavedDetails("mail");
			db1.get('maildata').remove().write();
            db1.defaults({ maildata: [{}] }).write();
            db1.get('maildata').push(value).write();
            
            if (type == "savesend") {
				var maximum = 100000;
				var minimum = 100;
				var randomnumber = Math.floor(Math.random() * (maximum - minimum + 1)) + minimum;
				document.getElementById("inputSubject").value = "Bunker Request - BRQ"+randomnumber+".json";
				document.getElementById("inputAttach").value = "BunkerRequest"+randomnumber+".json";
				
                $('#modalCompose').modal('show');
                var maildetail = (db.get('sysconfig').value());
                console.log(maildetail);
                $("#inputFrom").val(maildetail[0].from);
                $("#inputTo").val(maildetail[0].to);
                $("#ccTo").val(maildetail[0].vesselemail);
                $('#inputBody').val($('#brn_remarks').val());
            }
            else {
                alert("Successfully Saved");
                document.getElementById("brn").reset();
				var vessel = db.get('vesselinfo').value();
				$('#brn_service').val(vessel[0].service);
				$('#brn_vessel').val(vessel[0].vslname);
				$('#brn_vesselcode').val(vessel[0].vslcode);
            }
        }

        

    </script>
    <!-- <footer class="main-footer"> -->
    <!-- <strong> Copyright © 2017 <a href="http://www.solverminds.com" target="_blank">www.solverminds.com</a>.</strong> All rights reserved.  -->
    <!-- </footer>	 -->
    </div>


    </div>
    </div>
</div>
</div>
</div>


</div>

<!-- /#wrapper -->
<!-- <script>
    $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
</script> -->
<!-- jQuery -->
<script src="../vendor/jquery/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

<!-- Metis Menu Plugin JavaScript -->
<script src="../vendor/metisMenu/metisMenu.min.js"></script>


<!-- Custom Theme JavaScript -->
<script src="../dist/js/sb-admin-2.js"></script>

</body>

</html>