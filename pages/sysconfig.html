<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <script src="../vendor/jquery/jquery.js"></script>   
    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/mailconfig.js"></script>
    <script src="../js/rendered.js"></script>
    <script src="../js/masterreport.js"></script>
    <script src="../js/lowdb.js"></script>   
    <script src="/path/to/shared/js/modernizr.com/Modernizr-2.5.3.forms.js"> </script>    
    <style>
        .upload-btn-wrapper {
  position: relative;
  overflow: hidden;
  display: inline-block;
}

.btn1 {
  border: 2px solid gray;
  color: gray;
  background-color: white;
  padding: 8px 20px;
  border-radius: 8px;
  font-size: 20px;
  font-weight: bold;
}

.upload-btn-wrapper input[type=file] {
  font-size: 100px;
  position: absolute;
  left: 0;
  top: 0;
  opacity: 0;
}
</style>

</head>
    <!-- Page Content -->
    <form id="scheduleform">
        <div id="page-content-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div style="background:white;border: 1px solid #ffffff;height:800px;box-shadow: 5px 5px 27px #8f8e8e;border-radius: 10px;margin:0 auto;Z-INDEX: 2000; margin-top: -15px;">
                        <div class="col-sm-12 col-md-8 col-lg-12" style="font-size:20px;color:#00b6e3;margin-top: 5px;font-weight:bold;background-color: darkblue;margin-top: 0px; color:white;padding:5px;border-radius:10px 10px 0 0">
                            System Configuration </div>
                        <div style="margin-top: 50px">
                            
                            <div class="row">
                                <div id="another-element1">
                                <div class="col-sm-10 col-md-8 col-lg-10">

                                    <div class="col-sm-3 text-right" style="padding-top:5px;">System E-mail
                                        <span class="required" style="color:red">&nbsp;*</span>
                                    </div>
                                    <div class="col-sm-4">
                                        <input  class="form-control" id="from" readonly>
                                    </div>
								</div>
                                </div>
							</div>
							<div class="row">
								<div class="col-sm-10 col-md-8 col-lg-10">
									<div class="col-sm-3 text-right" style="padding-top:5px;">Shore E-mail
                                        <span class="required" style="color:red">&nbsp;*</span>
                                    </div>
                                    <div class="col-sm-4 ">
                                        <input class="form-control" id="to" readonly>

                                    </div>
								</div>
							</div>
                            <div id="another-element2">
                            <br/>
                            <br/>    
                            </div>
							
                            <div class="row">
                                <div class="col-sm-10 col-md-8 col-lg-10" style="border: 1px">
                                   <!--  <div class="col-sm-3 text-right" style="padding-top:5px;">User Mail Box
                                    </div>
                                    <div class="col-sm-4 ">
                                        <input type="checkbox"  id="manuelmail" onclick="onRemoveFields()"  style="margin-top:9px" value="false">
                                    </div> -->
                                    <div class="col-sm-3 text-right" style="padding-top:5px;">
                                    </div>
                                    <div class="col-sm-4 ">
                                        <input type="radio" name="am" id="auto" value="Auto" onclick=onRemoveFields() checked> Auto
                                        <input type="radio" name="am" id="manual" value="Manual" onclick=onRemoveFields()> Manual
                                     </div>
                                </div>
                            </div>
                            <div id="another-element">
							<div  class="row">
								<div class="col-sm-10 col-md-8 col-lg-10">	
                                    <div class="col-sm-3 text-right" style="padding-top:5px;">Host
                                        <span class="required" style="color:red">&nbsp;*</span>
                                    </div>
                                    <div class="col-sm-4 ">
                                        <input class="form-control" id="host" readonly>

                                    </div>
                                    <div class="col-sm-2 text-right" style="padding-top:5px;">SMTP Port
                                        <span class="required" style="color:red">&nbsp;*</span>
                                    </div>
                                    <div class="col-sm-3 ">
                                        <input class="form-control" id="smtpport" readonly onchange="portChange()">

                                    </div>
								</div>
							</div>

							<div class="row">
								<div class="col-sm-10 col-md-8 col-lg-10">
                                    <div class="col-sm-3 text-right" style="padding-top:5px;">User Name
                                        <span class="required" style="color:red">&nbsp;*</span>
                                    </div>
                                    <div class="col-sm-4 ">
                                        <input class="form-control" id="user" readonly>
    
                                    </div>
                                    <div class="col-sm-2 text-right" style="padding-top:5px;">TLS
                                    </div>
                                    <div class="col-sm-3 ">
                                        <input type="checkbox" disabled  id="secure"  style="margin-top:9px" value="false">
                                    </div>
								</div>
							</div>
							<div class="row">
								<div class="col-sm-10 col-md-8 col-lg-10">		
										
                                    <div class="col-sm-3 text-right" style="padding-top:5px;">Password
                                        <span class="required" style="color:red">&nbsp;*</span>
                                    </div>
                                    <div class="col-sm-4 ">
                                        <input type="password" class="form-control" id="pass" readonly>
                                    </div>
									<div class="col-sm-2 text-right" style="padding-top:5px;">Authentication
                                    </div>
                                    <div class="col-sm-3 ">
                                        <input type="checkbox" disabled  id="auth" onclick="disableUserPass()"  style="margin-top:9px" value="false">
                                    </div>
								</div>
							</div>
							<br/>
							<br/>
                            </div>
							<div class="row">
								<div class="col-sm-10 col-md-8 col-lg-10">	
                                    <div class="col-sm-3 text-right" style="padding-top:5px;">Vessel E-mail
                                        
                                    </div>
                                    <div class="col-sm-4 ">
                                        <input class="form-control" id="vslmail" readonly>
    
                                    </div>
                                    
                                </div>
                            </div>
                            <br>
                            <br>
                            <!-----------/buttons-------------->
                            <div class="form-group">
                                <div class="col-lg-10" style="text-align: center;">
                                    <button type="button" class="btn btn-primary" onclick=Editsysconfig()> <i class="fa fa-edit"> </i> Edit</button>
                                    <button type="button" class="btn btn-success" onclick="Savesysconfig()"> <i class="fa fa-save"> </i> Save</button>
                                </div>
                            </div>
                            <br/>
                            <br/>
                        </div>
                            
                    </div>
                </div>
                
            </div>
        </div>        
    </form> 
    <script type="text/javascript">
        $(document).ready(function () {
            makeActiveSidebar();
            var info = (db.get('sysconfig').value());
            console.log(JSON.stringify(info));

            if(info[0].manuelMail=='Auto'){
                document.getElementById("auto").checked=true;
                document.getElementById("manual").checked=false;
                $('#another-element').css("display","");
                $('#another-element1').css("display","");
                $('#another-element2').css("display","");
            } else{
                 document.getElementById("auto").checked=false;
                document.getElementById("manual").checked=true;
                $('#another-element').css("display","none");
                $('#another-element1').css("display","none");
                $('#another-element2').css("display","none");
            }

            $('#from').val(info[0].from);
            $('#to').val(info[0].to);
            $('#host').val(info[0].host);
            $('#smtpport').val(info[0].smtpport);
            $('#user').val(info[0].user);
            //var decrypted=CryptoJS.AES.decrypt(info[0].pass, "Secret Passphrase"); 
            var decrypted= window.atob(info[0].pass);

            $('#pass').val(decrypted);
            $('#vslmail').val(info[0].vesselemail);
            if(info[0].secure!=null){
                console.log('not null');
                document.getElementById("secure").checked=info[0].secure;            
            } else{
                console.log('not present');
                document.getElementById("secure").checked=false;
            }
            if(info[0].auth!=null){
                document.getElementById("auth").checked=info[0].auth;
            } else{
                document.getElementById("auth").checked=true;
            }
            document.getElementById("secure").disabled = true;
            document.getElementById("auto").disabled = true;
            document.getElementById("manual").disabled = true;
            // if(document.querySelector('input[name="am"]:checked').value=='Manual'){

            //     $('#another-element').hide("slide", { direction: "up" },0);
            // } else{
            //     $('#another-element').show("slide", { direction: "up" }, 0);
            // }
            
          });


      function makeActiveSidebar(){
    
                document.getElementById("noonFrom").setAttribute("class", "");
                document.getElementById("eospFrom").setAttribute("class", "");
                document.getElementById("arrivalFrom").setAttribute("class", "");
                document.getElementById("departureFrom").setAttribute("class", "");
                document.getElementById("bospFrom").setAttribute("class", "");
                document.getElementById("bunkerrequestFrom").setAttribute("class", "");
                document.getElementById("bdnFrom").setAttribute("class", "");
                document.getElementById("brobFrom").setAttribute("class", "");
                document.getElementById("vslinfo").setAttribute("class", "");
                document.getElementById("ports").setAttribute("class", "");
                document.getElementById("sysconfig").setAttribute("class", "active");
                document.getElementById("mailhistory").setAttribute("class", "");
                document.getElementById("masterFileupload").setAttribute("class", "");
    }

    function portChange() {
      
        if ($.trim($('#smtpport').val()) == 465) {                    
            document.getElementById("secure").checked = true;   
            document.getElementById("secure").disabled=true;        
        } else {
            document.getElementById("secure").checked = false;
            document.getElementById("secure").disabled=true;
        }
    }

          function  Savesysconfig(){          
            if(sysSaveValidation()) {
                 alert("Successfully saved");
                     $('input').attr("readonly",true);
                    // var encryptedPass = CryptoJS.AES.encrypt($('#pass').val(), "Secret Passphrase");
                    var encryptedPass = window.btoa($('#pass').val());
                     console.log('enc');
                     console.log(encryptedPass.toString());
                     console.log('end');
                     var amvalues=document.querySelector('input[name="am"]:checked').value;
                     
                        var obj = { "from": $('#from').val(), "to": $('#to').val(), "host": $('#host').val(), "smtpport": $('#smtpport').val(),"user": $('#user').val(),"pass": encryptedPass.toString(), "vesselemail": $('#vslmail').val(),"secure":document.getElementById("secure").checked,"manuelMail":amvalues,"auth":document.getElementById("auth").checked}
                        console.log(obj);
                        db.get('sysconfig').nth(0).assign(obj).value();
                		db.write();
                        document.getElementById("secure").disabled = true;
                        document.getElementById("auto").disabled = true;
                        document.getElementById("manual").disabled = true;
                        document.getElementById("auth").disabled = true;
                }
            }
      
      function sysSaveValidation(){
            
            if(document.querySelector('input[name="am"]:checked').value=='Manual'){
                if($.trim($('#to').val())==''){
                    alert("Kindly Enter the Shore E-mail");
                    return false;
                } else{
                    return true;
                }
            } else {

                if($.trim($('#from').val())==''){
                alert("Kindly Enter the System E-mail");
                    return false;
                }
                else if($.trim($('#to').val())==''){
                 alert("Kindly Enter the Shore E-mail");
                        return false;   
                }
                else if($.trim($('#host').val())==''){
                 alert("Kindly Enter the Host");
                        return false;   
                }
                else if($.trim($('#smtpport').val())==''){
                 alert("Kindly Enter the SMTP Port");
                        return false;   
                }
                else if(document.getElementById("auth").checked==false){
                    return true;
                } else{
                    console.log('inside auth');
                         if($.trim($('#user').val())==''){
                     alert("Kindly Enter the User Name");
                            return false;   
                    }
                    else if($.trim($('#pass').val())==''){
                     alert("Kindly Enter the Password");
                            return false;   
                    } else{
                        return true;    
                    }
                    
                }
            }
      }


      function Editsysconfig(){
        var values=document.querySelector('input[name="am"]:checked').value;

            if(values=='Manual'){
                 $('input').attr("readonly",false);
                document.getElementById("secure").disabled = true;
                document.getElementById("auto").disabled = false;
                document.getElementById("manual").disabled = false;
            } else{
                $('input').attr("readonly",false);
               if($('#smtpport').val()==465) {
               document.getElementById("secure").disabled = true; 
               } else{
               document.getElementById("secure").disabled = true; 
               }      
               document.getElementById("auto").disabled = false;
               document.getElementById("manual").disabled = false;
               document.getElementById("auth").disabled=false;
                   if(document.getElementById("auth").checked==true){
                    document.getElementById("user").disabled=false;
                    document.getElementById("pass").disabled=false;
                   } else{
                    document.getElementById("user").disabled=true;
                    document.getElementById("pass").disabled=true;
                   }
            }           
      }

      function onRemoveFields(){
        var values=document.querySelector('input[name="am"]:checked').value;
        if(values=='Manual'){
            $('input').attr("readonly",false);
            document.getElementById("secure").disabled = true;
            $('#another-element').hide();
            $('#another-element1').hide();
            $('#another-element2').hide();
        } else{
            $('input').attr("readonly",false);
            document.getElementById("secure").disabled = true;
            document.getElementById("auth").disabled=false;
            $('#another-element').show();
            $('#another-element1').show();
            $('#another-element2').show();
            document.getElementById("auth").checked=true;
            document.getElementById("user").disabled=false;
            document.getElementById("pass").disabled=false;

        }
      }

      function disableUserPass(){

        if(document.getElementById("auth").checked==false){
            document.getElementById("user").disabled=true;
            document.getElementById("pass").disabled=true;
            $('#user').val("");
            $('#pass').val("");
        } else{
            document.getElementById("user").disabled=false;
            document.getElementById("pass").disabled=false;
        }
        
      }

     

</script>
    <script type="text/javascript" src="../../shared/js/html5Forms.js" data-webforms2-support="date" data-webforms2-force-js-validation="true"
        data-webforms2-force-js-date-picker="true" data-lang="en">
    </script>

    <!-- /#wrapper -->
    

    <!-- jQuery -->
    <script src="../vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="../vendor/metisMenu/metisMenu.min.js"></script>


    <!-- Custom Theme JavaScript -->
    <script src="../dist/js/sb-admin-2.js"></script>
    </body>

</html>